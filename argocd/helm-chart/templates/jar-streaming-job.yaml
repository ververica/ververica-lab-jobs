apiVersion: ververica.platform/v1
kind: VvpDeployment
metadata:
  name: argocd-jar-streaming-job
  namespace: {{ .Values.k8s_namespace }}
  {{- if .Values.auth_enabled }}
  annotations:
    apikeySecretName: apikey-operator
  {{- end }}
spec:
  syncingMode: PATCH
  deployment:
    userMetadata:
      name: argocd-jar-streaming-job
      namespace: {{ .Values.vvp_namespace }}
    spec:
      state: RUNNING
      deploymentTargetName: {{ .Values.deployment_target }}
      restoreStrategy:
        kind: NONE
      upgradeStrategy:
        kind: STATELESS
      template:
        spec:
          artifact:
            flinkImageRegistry: registry.ververica.com/v2.15
            flinkImageTag: 1.19.0-stream3-scala_2.12-java11
            flinkVersion: '1.19'
            jarUri: >-
              https://repo1.maven.org/maven2/org/apache/flink/flink-examples-streaming_2.12/1.17.2/flink-examples-streaming_2.12-1.17.2-WindowJoin.jar
            # flinkImageRegistry: '{{ .Values.flink_image_registry }}'
            # flinkImageTag: '{{ .Values.flink_image_tag }}'
            # flinkVersion: '{{ .Values.flink_minor }}'
            # jarUri: >-
            #   https://repo1.maven.org/maven2/org/apache/flink/flink-examples-streaming{{ .Values.scala_suffix }}/{{ .Values.flink_version }}/flink-examples-streaming{{ .Values.scala_suffix }}-{{ .Values.flink_version }}-WindowJoin.jar
            kind: JAR
  initFields:
    userMetadata:
      displayName: "ArgoCD: Jar Streaming Job"
